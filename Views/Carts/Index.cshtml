@model LapTrinhWebBanHang.Models.Cart
@{
    ViewBag.Title = "Giỏ hàng của bạn";
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}

<h2>Giỏ hàng của bạn</h2>

<div id="cart-summary">
    @if (Model.Items.Count == 0)
    {
        <p>Giỏ hàng của bạn đang trống.</p>
    }
    else
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Sản phẩm</th>
                    <th>Số lượng</th>
                    <th>Đơn giá</th>
                    <th>Tổng</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Items)
                {
                    <tr>
                        <td>@item.ProductName</td>
                        <td>
                            <input type="number" value="@item.Quantity" min="1" onchange="updateCartItem(@item.ProductID, this.value)" />
                        </td>
                        <td>@item.Price</td>
                        <td>@(item.Quantity * item.Price)</td>
                        <td>
                            <button onclick="removeFromCart(@item.ProductID)" class="btn btn-danger">Xóa</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <p><strong>Tổng tiền: </strong>@Model.Total</p>

        <form action="@Url.Action("Checkout")" method="get">
            <button type="submit" class="btn btn-primary">Tiến hành thanh toán</button>
        </form>
    }
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">
    // Hàm thêm sản phẩm vào giỏ hàng
    function addToCart(productId, quantity) {
        $.ajax({
            url: '@Url.Action("AddToCart", "Carts")',
            type: 'GET',
            data: { productId: productId, quantity: quantity },
            success: function (data) {
                $('#cart-summary').html(data);  // Cập nhật tóm tắt giỏ hàng
            },
            error: function () {
                alert("Có lỗi xảy ra khi thêm vào giỏ hàng.");
            }
        });
    }

    // Hàm cập nhật số lượng sản phẩm trong giỏ hàng
    function updateCartItem(productId, newQuantity) {
        $.ajax({
            url: '@Url.Action("UpdateCartItem", "Carts")',
            type: 'POST',
            data: { productId: productId, quantity: newQuantity },
            success: function (data) {
                $('#cart-summary').html(data); // Cập nhật giỏ hàng
            },
            error: function () {
                alert("Có lỗi xảy ra khi cập nhật số lượng.");
            }
        });
    }

    // Hàm xóa sản phẩm khỏi giỏ hàng
    function removeFromCart(productId) {
        $.ajax({
            url: '@Url.Action("RemoveFromCart", "Carts")',
            type: 'POST',
            data: { productId: productId },
            success: function (data) {
                $('#cart-summary').html(data); // Cập nhật giỏ hàng
            },
            error: function () {
                alert("Có lỗi xảy ra khi xóa sản phẩm khỏi giỏ hàng.");
            }
        });
    }
</script>
